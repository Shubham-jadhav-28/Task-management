<div class="container mt-4">
  <!-- Logout Button -->
  <div class="d-flex justify-content-between align-items-center">
    <h2 class="mb-4">Projects</h2>
    <div>
      <button (click)="logout()" class="btn btn-danger">Logout</button>
      <a
        routerLink="/create-project"
        (click)="AddProject()"
        class="btn btn-primary ms-2"
        >Create New Project</a
      >
    </div>
  </div>

  <div *ngIf="isLoggedIn()" class="welcome-message text-center p-3">
    <p class="fw-normal display-4 text-success">
      Welcome, {{ getUsername() }}!
    </p>
  </div>

  <!-- Project List -->
  <div class="table-responsive" *ngIf="!selectedProject">
    <table class="table table-bordered table-striped">
      <thead class="table-hover">
        <tr>
          <th>Title</th>
          <th>Description</th>
          <th>Created By</th>
          <th>Manager</th>
          <th>Start Date</th>
          <th>End Date</th>
          <th>Team Members</th>
          <th>Due Date</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr
          *ngFor="let project of projects"
          (click)="viewProjectDetails(project)"
          class="clickable-row"
        >
          <td>{{ project.title }}</td>
          <td>{{ project.description }}</td>
          <td>{{ project.createdBy }}</td>
          <td>{{ project.manager }}</td>
          <td>{{ project.startDate }}</td>
          <td>{{ project.endDate }}</td>
          <td>{{ project.teamMembers }}</td>
          <td>{{ project.dueDate }}</td>
          <td>
            <button class="btn btn-success ms-2" (click)="AddTask()">
              Add Task
            </button>
            <button
              class="btn btn-danger btn-sm ms-2"
              (click)="deleteProject(project)"
            >
              Delete
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Project Details Section -->
  <div *ngIf="selectedProject" class="project-details mt-4">
    <h3>Project Details</h3>
    <table class="table table-bordered">
      <tr>
        <th>Title</th>
        <td>{{ selectedProject.title }}</td>
      </tr>
      <tr>
        <th>Description</th>
        <td>{{ selectedProject.description }}</td>
      </tr>
      <tr>
        <th>Created By</th>
        <td>{{ selectedProject.createdBy }}</td>
      </tr>
      <tr>
        <th>Manager</th>
        <td>{{ selectedProject.manager }}</td>
      </tr>
      <tr>
        <th>Start Date</th>
        <td>{{ selectedProject.startDate }}</td>
      </tr>
      <tr>
        <th>End Date</th>
        <td>{{ selectedProject.endDate }}</td>
      </tr>
      <tr>
        <th>Team Members</th>
        <td>{{ selectedProject.teamMembers }}</td>
      </tr>
      <tr>
        <th>Due Date</th>
        <td>{{ selectedProject.dueDate }}</td>
      </tr>
    </table>
    <h4 class="mt-4">Tasks</h4>
    <table
      class="table table-striped"
      *ngIf="projectTasks.length > 0; else noTasks"
    >
      <thead>
        <tr>
          <th>Title</th>
          <th>Assigned To</th>
          <th>Status</th>
          <th>Estimate</th>
          <th>Time Spent</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let task of projectTasks">
          <td>{{ task.title }}</td>
          <td>{{ task.assignedTo }}</td>
          <td>{{ task.status }}</td>
          <td>{{ task.estimate }} hrs</td>
          <td>{{ task.timeSpent }} hrs</td>
        </tr>
      </tbody>
    </table>

    <ng-template #noTasks>
      <p class="text-muted">No tasks assigned to this project.</p>
    </ng-template>
    <button class="btn btn-secondary" (click)="closeProjectDetails()">
      Back to Projects
    </button>

    <button class="btn btn-warning ms-2" (click)="editProject()">Edit</button>
  </div>

  <div class="card p-4 shadow-lg mt-3" *ngIf="isEditing">
    <h2 class="mb-3">Edit Project</h2>
    <form (ngSubmit)="updateProject()">
      <div class="mb-3">
        <label class="form-label">Title</label>
        <input
          type="text"
          class="form-control"
          [(ngModel)]="selectedProject.title"
          name="title"
          required
        />
      </div>

      <div class="mb-3">
        <label class="form-label">Description</label>
        <input
          type="text"
          class="form-control"
          [(ngModel)]="selectedProject.description"
          name="description"
          required
        />
      </div>

      <div class="mb-3">
        <label class="form-label">Manager</label>
        <input
          type="text"
          class="form-control"
          [(ngModel)]="selectedProject.manager"
          name="manager"
          required
        />
      </div>

      <div class="mb-3">
        <label class="form-label">Start Date</label>
        <input
          type="date"
          class="form-control"
          [(ngModel)]="selectedProject.startDate"
          name="startDate"
          required
        />
      </div>

      <div class="mb-3">
        <label class="form-label">End Date</label>
        <input
          type="date"
          class="form-control"
          [(ngModel)]="selectedProject.endDate"
          name="endDate"
          required
        />
      </div>

      <div class="mb-3">
        <label class="form-label">Team Members</label>
        <input
          type="text"
          class="form-control"
          [(ngModel)]="selectedProject.teamMembers"
          name="teamMembers"
          required
        />
      </div>

      <div class="mb-3">
        <label class="form-label">Due Date</label>
        <input
          type="date"
          class="form-control"
          [(ngModel)]="selectedProject.dueDate"
          name="dueDate"
          required
        />
      </div>

      <div class="d-flex">
        <button type="submit" class="btn btn-success me-2">
          Update Project
        </button>
        <button
          type="button"
          class="btn btn-secondary"
          (click)="closeProjectDetails()"
        >
          Cancel
        </button>
      </div>
    </form>
  </div>
</div>
